# Supabase Configuration
VITE_SUPABASE_PROJECT_ID="your-project-id"
VITE_SUPABASE_PUBLISHABLE_KEY="your-publishable-key"
VITE_SUPABASE_URL="https://your-project-id.supabase.co"

# ============================================
# FEATURE FLAGS FOR PIPELINE HARDENING
# ============================================
# These flags control the hardening features for the message pipeline
# All flags default to 'false' to maintain current behavior

# CORS Configuration
# Default: '*' (allow all origins)
# Set to specific domain(s) to restrict access
CORS_ALLOWED_ORIGIN=*

# Evolution Webhook Secret Enforcement
# Default: false (secret validation optional)
# Set to 'true' to require valid x-evo-secret header
ENFORCE_EVO_WEBHOOK_SECRET=false

# N8N Secret Enforcement  
# Default: false (secret validation optional)
# Set to 'true' to require valid Authorization header
ENFORCE_N8N_SECRET=false

# Message Idempotency
# Default: false (allow duplicate messages)
# Set to 'true' to prevent duplicate messages using external_id
ENABLE_MESSAGE_IDEMPOTENCY=false

# Supabase Realtime Usage
# Default: true (use Realtime for real-time updates)
# Set to 'false' to disable Realtime features
USE_SUPABASE_REALTIME=true

# SSE Fallback Support
# Default: true (enable SSE as fallback when Realtime fails)
# Set to 'false' to disable SSE fallback
ENABLE_SSE_FALLBACK=true

# Schema Enforcement (NOT IMPLEMENTED YET)
# Default: false (workspace_id can be null)
# Set to 'true' only after null audit shows 0 nulls
ENFORCE_SET_NOT_NULL_AFTER_AUDIT=false

# ============================================
# ACTIVATION STRATEGY (RECOMMENDED ORDER)
# ============================================
# 1. Start with ENABLE_MESSAGE_IDEMPOTENCY=true
#    - Test for 24h, verify no duplicates
#    - Check logs for "Using upsert for idempotency"
# 
# 2. Enable ENFORCE_EVO_WEBHOOK_SECRET=true
#    - Ensure Evolution API sends correct x-evo-secret
#    - Check logs for "enforcement enabled" messages
# 
# 3. Enable ENFORCE_N8N_SECRET=true  
#    - Ensure N8N sends correct Authorization header
#    - Check logs for "enforcement enabled" messages
#
# 4. Restrict CORS_ALLOWED_ORIGIN to your domain
#    - Change from '*' to 'https://yourdomain.com'
#    - Test all frontend functionality
#
# 5. Optionally disable ENFORCE_SET_NOT_NULL_AFTER_AUDIT=true
#    - Only if audit query shows 0 null workspace_id values
#    - This makes workspace_id NOT NULL in database

# ============================================
# ROLLBACK INSTRUCTIONS
# ============================================
# If any issues occur:
# 1. Set problematic flag back to 'false'
# 2. Restart edge functions (automatic on deploy)
# 3. Monitor logs for "enforcement disabled" messages
# 4. All functionality should return to previous behavior